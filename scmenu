#!/bin/sh -e
line_cache="${XDG_CACHE_HOME:-"$HOME/.cache"}/scm/line_cache"
if [ ! -f "$line_cache" ]; then
	>&2 printf "cache file '%s' not found!\n" "$line_cache"
	exit 1
fi

str="$(cat "$line_cache" | cut -f2- | dmenu -l 5 "$@" | sed 's/[][()\.^$*+?|{}`]/\\&/g')"
entry_file="$(grep -E "$str" "$line_cache" | awk '{print $1}')"

if [ -f "$entry_file" ]; then
	xsel --clipboard < "$entry_file"
fi
